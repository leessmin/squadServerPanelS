import{S as Y}from"./SectionPanel-bf0ce22b.js";import{u as Z}from"./useAdminStore-4bb0703f.js";import{d as ee,k as w,r as b,D as te,o as l,e as i,g as d,h as c,c as y,f as u,q as S,i as h,F as N,t as k,C as z,A as ae,j as F,E,x as ne,s as oe,v as se}from"./index-2df293b2.js";import{_ as le}from"./_plugin-vue_export-helper-c27b6911.js";import"./http-9bd06147.js";import"./config-9c65774d.js";import"./worker-e1b6861a.js";import"./getSteamName-10fa85f4.js";const P=x=>(oe("data-v-f5f4af79"),x=x(),se(),x),ie=P(()=>u("div",{class:"title-box"},[u("h3",null,"管理员")],-1)),de={class:"btn-box"},ce={style:{"margin-right":"10px"}},re={style:{"margin-left":"8px"}},ue={class:"table"},pe={style:{padding:"8px"}},me={key:1},_e={key:0},he={key:1},ye={key:1},fe={key:2},ve={class:"editable-row-operations",style:{display:"inline-block"}},ge={key:0},ke=P(()=>u("a",null,"取消",-1)),xe={key:1},we=["onClick"],Ie={class:"delete",style:{display:"inline-block"}},Ce=ee({__name:"AdminUser",setup(x){const I=w([]),U=w([{title:"steam昵称",dataIndex:"steamName",width:"20%",fixed:"left",customFilterDropdown:!0,onFilter:(e,t)=>t.steamName.toString().toLowerCase().includes(e.toLowerCase()),onFilterDropdownVisibleChange:e=>{e&&setTimeout(()=>{R.value.focus()},100)}},{title:"steamID",dataIndex:"steamId",width:"30%"},{title:"管理组",dataIndex:"groupName",width:"30%",filters:[{text:"初始化",value:"初始化"}],onFilter:(e,t)=>t.groupName===e},{title:"操作",dataIndex:"operation",width:"20%",fixed:"right"}]);function T(e){let t=[];e.forEach(a=>{t.push({text:a.value,value:a.value})}),U.value[2].filters=t}const o=w([]),s=b({}),V=e=>{s[e]=E(o.value.filter(t=>e===t.key)[0])},B=e=>{let t=s[e];if(t.steamId==""||t.groupName==""){ne.warning("信息填写不完整");return}f.addEditAdminUser(t),Object.assign(o.value.filter(a=>e===a.key)[0],s[e]),delete s[e]},L=e=>{o.value=o.value.filter(t=>!(e===t.key&&(t.steamId==""||t.groupName==""))),delete s[e]},O=(e,t)=>{f.delAdminUser([t]),o.value=o.value.filter(a=>a.key!==e)};function j(){console.log("添加");let e=o.value[o.value.length-1]!=null?o.value[o.value.length-1].key+1:"0";s[e]={key:e,steamName:"",steamId:"",groupName:""},o.value.push(E(s[e])),v.current=Math.ceil(o.value.length/v.defaultPageSize)}const R=w(),$=(e,t,a)=>{t()},H=e=>{e({confirm:!0})},r=b({selectedRowKeys:[],loading:!1}),A=te(()=>r.selectedRowKeys.length>0),q=e=>{console.log("selectedRowKeys changed: ",e),r.selectedRowKeys=e};async function M(){r.loading=!0;let e=[];for(let t=0;t<r.selectedRowKeys.length;t++)o.value=o.value.filter(a=>(a.key==r.selectedRowKeys[t]&&e.push(a.steamId),r.selectedRowKeys[t]!==a.key));await f.delAdminUser(e),r.loading=!1,r.selectedRowKeys=[]}const f=Z();f.getAdminUser(),f.$subscribe((e,t)=>{o.value=t.adminUser,I.value=f.groupNameList,T(I.value)});let v=b({current:1,defaultPageSize:10,showTotal:e=>`共 ${e} 条数据`,showSizeChanger:!1});function G(e){console.log(v),v.current=e.current}return(e,t)=>{const a=y("a-button"),D=y("a-input"),J=y("SearchOutlined"),Q=y("a-select"),W=y("a-typography-link"),K=y("a-popconfirm"),X=y("a-table");return l(),i("main",null,[d(Y,{class:"mt-zero"},{default:c(()=>[ie,u("div",de,[u("div",ce,[d(a,{type:"primary",danger:"",disabled:!S(A),loading:r.loading,onClick:M},{default:c(()=>[h(" 删除 ")]),_:1},8,["disabled","loading"]),u("span",re,[S(A)?(l(),i(N,{key:0},[h(k(`选中 ${r.selectedRowKeys.length} 行`),1)],64)):z("",!0)])]),d(a,{type:"primary",class:"editable-add-btn",onClick:j},{default:c(()=>[h("添加")]),_:1})]),u("div",ue,[d(X,{columns:U.value,"data-source":o.value,bordered:"",pagination:S(v),scroll:{x:1e3},"row-selection":{selectedRowKeys:r.selectedRowKeys,onChange:q},onChange:G},{customFilterDropdown:c(({setSelectedKeys:p,selectedKeys:_,confirm:n,clearFilters:m,column:C})=>[u("div",pe,[d(D,{ref_key:"searchInput",ref:R,placeholder:`搜索 ${C.title}`,value:_[0],style:{width:"188px","margin-bottom":"8px",display:"block"},onChange:g=>p(g.target.value?[g.target.value]:[]),onPressEnter:g=>$(_,n,C.dataIndex)},null,8,["placeholder","value","onChange","onPressEnter"]),d(a,{type:"primary",size:"small",style:{width:"90px","margin-right":"8px"},onClick:g=>$(_,n,C.dataIndex)},{icon:c(()=>[d(J)]),default:c(()=>[h(" 搜索 ")]),_:2},1032,["onClick"]),d(a,{size:"small",style:{width:"90px"},onClick:g=>H(m)},{default:c(()=>[h(" 重置 ")]),_:2},1032,["onClick"])])]),bodyCell:c(({column:p,text:_,record:n})=>[p.dataIndex==="steamName"?(l(),i("div",{key:0,style:ae({color:n.steamName==""?"var(--ant-primary-color)":"var(--text-color)"})},k(n.steamName||"未找到该steamID下的信息"),5)):p.dataIndex==="steamId"?(l(),i("div",me,[s[n.key]?(l(),i("div",_e,[_.length==0?(l(),F(D,{key:0,value:s[n.key][p.dataIndex],"onUpdate:value":m=>s[n.key][p.dataIndex]=m,style:{margin:"-5px 0"}},null,8,["value","onUpdate:value"])):(l(),i("div",he,k(_),1))])):(l(),i("div",ye,k(_),1))])):p.dataIndex==="groupName"?(l(),i("div",fe,[s[n.key]?(l(),F(Q,{key:0,options:I.value,"show-search":"",value:s[n.key][p.dataIndex],"onUpdate:value":m=>s[n.key][p.dataIndex]=m,style:{width:"300px"}},null,8,["options","value","onUpdate:value"])):(l(),i(N,{key:1},[h(k(_),1)],64))])):p.dataIndex==="operation"?(l(),i(N,{key:3},[u("div",ve,[s[n.key]?(l(),i("span",ge,[d(W,{onClick:m=>B(n.key),style:{"margin-right":"10px"}},{default:c(()=>[h("保存")]),_:2},1032,["onClick"]),d(K,{title:"你确定要取消吗",onConfirm:m=>L(n.key),okText:"确定",cancelText:"取消"},{default:c(()=>[ke]),_:2},1032,["onConfirm"])])):(l(),i("span",xe,[u("a",{onClick:m=>V(n.key)},"编辑",8,we)]))]),u("div",Ie,[d(K,{title:"你确定要删除吗","ok-text":"确定","cancel-text":"取消",onConfirm:m=>O(n.key,n.steamId)},{default:c(()=>[d(a,{type:"link",danger:""},{default:c(()=>[h("删除")]),_:1})]),_:2},1032,["onConfirm"])])],64)):z("",!0)]),_:1},8,["columns","data-source","pagination","row-selection"])])]),_:1})])}}});const Ke=le(Ce,[["__scopeId","data-v-f5f4af79"]]);export{Ke as default};
