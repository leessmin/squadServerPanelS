var f=Object.defineProperty;var p=(s,t,e)=>t in s?f(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var a=(s,t,e)=>(p(s,typeof t!="symbol"?t+"":t,e),e);import{b,t as m}from"./config-9c65774d.js";import{x as d}from"./index-2df293b2.js";class R{constructor(t,e=-1){a(this,"baseUrl");a(this,"timeOut");a(this,"interceptorsReq",[]);a(this,"interceptorsRes",[]);a(this,"timeOutHandle");this.baseUrl=t,this.timeOut=e}addInterceptorsReq(t){this.interceptorsReq.push(t)}useInterceptorsReq(t,e){let n=t,r=e,i=!1;try{this.interceptorsReq.forEach(o=>{let l=o(n,r);if(n=l.url,r=l.method,l.abort)throw i=l.abort,"拦截"})}catch{}return{url:n,method:r,abort:i}}addInterceptorsRes(t){this.interceptorsRes.push(t)}useInterceptorsRes(t){let e=!1;try{this.interceptorsRes.forEach(n=>{let r=n(t);if(t=r.result,r.abort)throw"被拦截了"})}catch{e=!0}return{result:t,abort:e}}addTimeOutHandle(t){this.timeOutHandle=t}async Require(t,e){var c;t=this.pathJoin(this.baseUrl,t);let{url:n,method:r,abort:i}=this.useInterceptorsReq(t,e);if(i)return null;let o={c:null,timer:null};this.timeOut!=-1&&(o=this.controllerTimeOut(),r.signal=(c=o.c)==null?void 0:c.signal);let l=await this.useFetch(n,r,o.timer),h=this.useInterceptorsRes(l);return h.abort?null:h.result}async useFetch(t,e,n){return fetch(t,e).then(i=>(this.clearController(n),i)).then(i=>i.json())}controllerTimeOut(){let t=new AbortController,e=window.setTimeout(()=>{t.abort(),console.log("fetch请求关闭，原因：超时了"),this.timeOutHandle!=null&&this.timeOutHandle()},this.timeOut);return{c:t,timer:e}}clearController(t){t!=null&&clearTimeout(t)}pathJoin(...t){if(t.length==0)return"";let e=[];return t.forEach(r=>{r[0]=="/"?r=r.substring(1,r.length):r[r.length-1]=="/"&&(r=r.substring(0,r.length-1)),e.push(r)}),e.join("/")}}let u;function y(){return u==null&&(u=new R(b,m),u.addTimeOutHandle(O),u.addInterceptorsReq(g),u.addInterceptorsRes(q)),u}function O(){d.warning("你的网速有点小慢啊，请刷新页面后重试")}function g(s,t){if(s.includes("BA")){let e=localStorage.getItem("token");e!=null&&(t.headers={...t.headers,Authorization:`Bearer ${e}`})}return{url:s,method:t,abort:!1}}function q(s){let t=s;return t.code!=200&&d.error(t.msg),{result:s,abort:!1}}export{y as h};
