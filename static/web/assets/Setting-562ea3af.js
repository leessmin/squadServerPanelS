import{S as R}from"./SectionPanel-bf0ce22b.js";import{n as $,k,x as A,d as V,w,r as T,o as C,j as N,h as n,q as D,J,c as v,g as t,i as P,K as z,e as E,f as o,F as H,s as K,v as M}from"./index-2df293b2.js";import{h as S}from"./http-9bd06147.js";import{d as G}from"./formData-4b5941f0.js";import{e as L}from"./exitPanel-9be94f3b.js";import{_ as Q}from"./_plugin-vue_export-helper-c27b6911.js";import"./config-9c65774d.js";const O=$("setting",()=>{const c=k();async function d(){const i=await S().Require("/BA/panel/get",{});(i==null?void 0:i.code)==200&&(c.value=i==null?void 0:i.data.config)}async function f(i,m){const l={[i]:m},e=await S().Require("/BA/panel/update",{method:"POST",body:JSON.stringify(l)});if((e==null?void 0:e.code)!=200){d();return}A.success("保存成功")}async function s(i,m,l,e){const U=G({username:i,password:m,newUsername:l,newPassword:e}),_=await S().Require("/auth/updateAuth",{method:"POST",body:U});(_==null?void 0:_.code)==200&&L()}return{cfgSetting:c,getSetting:d,saveSetting:f,editAdmin:s}}),W=V({__name:"UserModal",props:{isUserVisible:{type:Boolean}},emits:["update:isUserVisible"],setup(c,{emit:d}){const f=c;let s=k(f.isUserVisible);w(f,(u,a)=>{s.value=u.isUserVisible}),w(s,(u,a)=>{d("update:isUserVisible",u)});const i=()=>{console.log(111)},m=k(),l=T({oldUser:"",user:"",oldPass:"",pass:"",checkPass:""}),x={oldUser:[{required:!0,validator:async(u,a)=>a===""?Promise.reject("请输入账号"):Promise.resolve(),trigger:"change"}],oldPass:[{required:!0,validator:async(u,a)=>a===""?Promise.reject("请输入旧密码"):Promise.resolve(),trigger:"change"}],pass:[{required:!0,validator:async(u,a)=>{var g;return a===""?Promise.reject("请输入密码"):(l.checkPass!==""&&((g=m.value)==null||g.validateFields("checkPass")),Promise.resolve())},trigger:"change"}],checkPass:[{validator:async(u,a)=>a===""?Promise.reject("请确认密码"):a!==l.pass?Promise.reject("两次密码不一致"):Promise.resolve(),trigger:"change"}]},r={labelCol:{span:4},wrapperCol:{span:14}},j=u=>{let a=u.user;a==""&&(a=u.oldUser),q.editAdmin(u.oldUser,u.oldPass,a,u.checkPass)},q=O();return(u,a)=>{const g=v("a-input"),y=v("a-form-item"),B=v("a-button"),I=v("a-form"),F=v("a-modal");return C(),N(F,{visible:D(s),"onUpdate:visible":a[5]||(a[5]=p=>J(s)?s.value=p:s=p),title:"修改账号密码",onOk:i,footer:null},{default:n(()=>[t(I,z({ref_key:"formRef",ref:m,name:"custom-validation",model:l,rules:x},r,{onFinish:j}),{default:n(()=>[t(y,{"has-feedback":"",label:"旧账号",name:"oldUser"},{default:n(()=>[t(g,{value:l.oldUser,"onUpdate:value":a[0]||(a[0]=p=>l.oldUser=p),type:"text",autocomplete:"off"},null,8,["value"])]),_:1}),t(y,{"has-feedback":"",label:"新账号",name:"user"},{default:n(()=>[t(g,{value:l.user,"onUpdate:value":a[1]||(a[1]=p=>l.user=p),type:"text",autocomplete:"off"},null,8,["value"])]),_:1}),t(y,{"has-feedback":"",label:"旧密码",name:"oldPass"},{default:n(()=>[t(g,{value:l.oldPass,"onUpdate:value":a[2]||(a[2]=p=>l.oldPass=p),type:"password",autocomplete:"off"},null,8,["value"])]),_:1}),t(y,{"has-feedback":"",label:"新密码",name:"pass"},{default:n(()=>[t(g,{value:l.pass,"onUpdate:value":a[3]||(a[3]=p=>l.pass=p),type:"password",autocomplete:"off"},null,8,["value"])]),_:1}),t(y,{"has-feedback":"",label:"确认密码",name:"checkPass"},{default:n(()=>[t(g,{value:l.checkPass,"onUpdate:value":a[4]||(a[4]=p=>l.checkPass=p),type:"password",autocomplete:"off"},null,8,["value"])]),_:1}),t(y,{"wrapper-col":{span:14,offset:4}},{default:n(()=>[t(B,{type:"primary","html-type":"submit"},{default:n(()=>[P("修改")]),_:1})]),_:1})]),_:1},16,["model"])]),_:1},8,["visible"])}}}),h=c=>(K("data-v-c3a112c3"),c=c(),M(),c),X=h(()=>o("div",{class:"title-box"},[o("h3",null,"面板设置")],-1)),Y={class:"setting-box"},Z={class:"input-box"},ee=h(()=>o("span",null,"默认为外网IP,若您在本地虚拟机测试，请填写虚拟机内网IP",-1)),te={class:"input-box"},ae=h(()=>o("span",null,"建议端口范围8888 - 65535，注意：有安全组的服务器请提前在安全组放行新端口",-1)),se={class:"input-box"},le=h(()=>o("span",null,"监听系统信息的时间间隔，建议1-5秒",-1)),ne={class:"input-box"},oe=h(()=>o("span",null,"游戏服务器的根路径",-1)),ie={class:"input-box"},re=V({__name:"Setting",setup(c){const d={style:{width:"120px"}},f=k(!1),s=k({server_ip:"",panel_port:8888,game_serve_path:"",listening_time:5}),i=(l,e)=>{m.saveSetting(l,e)},m=O();return m.getSetting(),m.$subscribe((l,e)=>{s.value=e.cfgSetting}),(l,e)=>{const U=v("a-input"),_=v("a-form-item"),b=v("a-button"),x=v("a-input-number");return C(),E(H,null,[o("main",null,[t(R,{class:"mt-zero"},{default:n(()=>[X,o("div",Y,[o("ul",null,[o("li",null,[t(_,{label:"服务器ip",name:"serverIp",style:{margin:"0"},"label-col":d},{default:n(()=>[o("div",Z,[t(U,{value:s.value.server_ip,"onUpdate:value":e[0]||(e[0]=r=>s.value.server_ip=r)},null,8,["value"])])]),_:1}),t(b,{type:"primary",style:{margin:"0 10px"},onClick:e[1]||(e[1]=r=>i("server_ip",s.value.server_ip))},{default:n(()=>[P("保存")]),_:1}),ee]),o("li",null,[t(_,{label:"面板端口",name:"panelPort",style:{margin:"0"},"label-col":d},{default:n(()=>[o("div",te,[t(x,{value:s.value.panel_port,"onUpdate:value":e[2]||(e[2]=r=>s.value.panel_port=r),style:{width:"100%"}},null,8,["value"])])]),_:1}),t(b,{type:"primary",style:{margin:"0 10px"},onClick:e[3]||(e[3]=r=>i("panel_port",s.value.panel_port))},{default:n(()=>[P("保存")]),_:1}),ae]),o("li",null,[t(_,{label:"监听时间",name:"listeningTime",style:{margin:"0"},"label-col":d},{default:n(()=>[o("div",se,[t(x,{value:s.value.listening_time,"onUpdate:value":e[4]||(e[4]=r=>s.value.listening_time=r),style:{width:"100%"},min:1,max:10},null,8,["value"])])]),_:1}),t(b,{type:"primary",style:{margin:"0 10px"},onClick:e[5]||(e[5]=r=>i("listening_time",s.value.listening_time))},{default:n(()=>[P("保存")]),_:1}),le]),o("li",null,[t(_,{label:"游戏服务器路径",name:"gameServePath",style:{margin:"0"},"label-col":d},{default:n(()=>[o("div",ne,[t(U,{value:s.value.game_serve_path,"onUpdate:value":e[6]||(e[6]=r=>s.value.game_serve_path=r)},null,8,["value"])])]),_:1}),t(b,{type:"primary",style:{margin:"0 10px"},onClick:e[7]||(e[7]=r=>i("game_serve_path",s.value.game_serve_path))},{default:n(()=>[P("保存")]),_:1}),oe]),o("li",null,[t(_,{label:"账号密码",name:"listeningTime",style:{margin:"0"},"label-col":d},{default:n(()=>[o("div",ie,[t(b,{type:"primary",style:{width:"100%"},onClick:e[8]||(e[8]=r=>f.value=!0)},{default:n(()=>[P("修改账号密码")]),_:1})])]),_:1})])])])]),_:1})]),t(W,{isUserVisible:f.value,"onUpdate:isUserVisible":e[9]||(e[9]=r=>f.value=r)},null,8,["isUserVisible"])],64)}}});const fe=Q(re,[["__scopeId","data-v-c3a112c3"]]);export{fe as default};
