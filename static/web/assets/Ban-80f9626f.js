import{S as Z}from"./SectionPanel-bf0ce22b.js";import{n as ee,k as P,D as j,p as te,d as ae,r as $,o as l,e as d,g as r,h as u,c as k,f as y,q as D,i as h,F as x,t as I,C as M,A as ne,j as E,E as U,x as se,s as oe,v as le}from"./index-2df293b2.js";import{h as K}from"./http-9bd06147.js";import{W as ie,M as de}from"./worker-e1b6861a.js";import{g as ce,d as re}from"./getSteamName-10fa85f4.js";import{_ as ue}from"./_plugin-vue_export-helper-c27b6911.js";import"./config-9c65774d.js";const me=ee("bans",()=>{const f=P([]);async function S(){const o=await K().Require("/BA/bans/get",{});if((o==null?void 0:o.code)!=200)return;if(o.data.bansPlayers==null){f.value=[];return}const g=new ie;new de(g,B=>{f.value=B.data,ce(f.value)}).sendMsg(o.data.bansPlayers)}async function i(o){const g={steamId:o.steamId,info:o.info,bansTime:o.bansTime==null?"0":`${o.bansTime.unix()}`},m=await K().Require("/BA/bans/addEdit",{method:"POST",body:JSON.stringify(g)});(m==null?void 0:m.code)!=200&&S()}async function a(o){let g=re("steamIds",o);const m=await K().Require(`/BA/bans/del?${g}`,{method:"DELETE"});console.log(m)}const T=j(()=>{const o=[];return f.value.forEach(g=>{let m=JSON.parse(JSON.stringify(g));m.bansTime=te(Number(m.bansTime)*1e3),o.push(m)}),o});return{banserList:f,getBans:S,addEditBans:i,banserListFormatTime:T,delBans:a}}),q=f=>(oe("data-v-5ca804b2"),f=f(),le(),f),pe=q(()=>y("div",{class:"title-box"},[y("h3",null,"封禁")],-1)),_e={class:"btn-box"},ye={style:{"margin-right":"10px"}},fe={style:{"margin-left":"8px"}},he={class:"table"},ge={style:{padding:"8px"}},ve={key:1},ke={key:0},be={key:2},xe={key:1},Ie={class:"editable-row-operations",style:{display:"inline-block"}},we={key:0},Ce=q(()=>y("a",null,"取消",-1)),Se={key:1},Te=["onClick"],Be={class:"delete",style:{display:"inline-block"}},Ne=ae({__name:"Ban",setup(f){const S=[{title:"steam昵称",dataIndex:"steamName",width:"25%",fixed:"left",customFilterDropdown:!0,onFilter:(e,t)=>t.steamName.toString().toLowerCase().includes(e.toLowerCase()),onFilterDropdownVisibleChange:e=>{e&&setTimeout(()=>{F.value.focus()},100)}},{title:"steamID",dataIndex:"steamId",width:"25%"},{title:"原因",dataIndex:"info",width:"20%"},{title:"封禁时间",dataIndex:"bansTime",sorter:(e,t)=>Number(e.bansTime)-Number(t.bansTime)},{title:"操作",dataIndex:"operation",fixed:"right"}],i=P([]),a=$({}),T=e=>{var t;a[e]=U(i.value.filter(s=>e===s.key)[0]),a[e].bansTime=((t=a[e].bansTime)==null?void 0:t.unix())==0?null:a[e].bansTime},o=e=>{let t=a[e];if(t.steamId==""||t.info==""){se.warning("信息填写不完整");return}b.addEditBans(t),Object.assign(i.value.filter(s=>e===s.key)[0],a[e]),delete a[e]},g=e=>{i.value=i.value.filter(t=>!(e===t.key&&t.steamId=="")),delete a[e]},m=e=>{let t=[];i.value=i.value.filter(s=>(s.key==e&&t.push(s.steamId),s.key!==e)),b.delBans(t)};function B(){console.log("添加");let e=`${Number(i.value[i.value.length-1].key)+1}`;a[e]={key:e,steamName:"",steamId:"",info:"",bansTime:null},i.value.push(U(a[e])),w.current=Math.ceil(i.value.length/w.defaultPageSize)}const F=P(),O=(e,t,s)=>{t()},A=e=>{e({confirm:!0})},p=$({selectedRowKeys:[],loading:!1}),z=j(()=>p.selectedRowKeys.length>0),V=e=>{console.log("selectedRowKeys changed: ",e),p.selectedRowKeys=e};async function H(){p.loading=!0;let e=[];for(let t=0;t<p.selectedRowKeys.length;t++)i.value=i.value.filter(s=>(p.selectedRowKeys[t]==s.key&&e.push(s.steamId),p.selectedRowKeys[t]!==s.key));await b.delBans(e),p.loading=!1,p.selectedRowKeys=[]}const b=me();b.getBans(),b.$subscribe((e,t)=>{i.value=b.banserListFormatTime});let w=$({current:1,defaultPageSize:10,showTotal:e=>`共 ${e} 条数据`,showSizeChanger:!1});function W(e){console.log(w),w.current=e.current}return(e,t)=>{const s=k("a-button"),Y=k("a-tooltip"),N=k("a-input"),J=k("SearchOutlined"),Q=k("a-date-picker"),G=k("a-typography-link"),L=k("a-popconfirm"),X=k("a-table");return l(),d("main",null,[r(Z,{class:"mt-zero"},{default:u(()=>[pe,y("div",_e,[y("div",ye,[r(s,{type:"primary",danger:"",disabled:!D(z),loading:p.loading,onClick:H},{default:u(()=>[h(" 删除 ")]),_:1},8,["disabled","loading"]),y("span",fe,[D(z)?(l(),d(x,{key:0},[h(I(`选中 ${p.selectedRowKeys.length} 行`),1)],64)):M("",!0)])]),r(Y,{placement:"topLeft",title:"当封禁时间为空时，将永久封禁"},{default:u(()=>[r(s,{type:"primary",class:"editable-add-btn",onClick:B},{default:u(()=>[h("添加")]),_:1})]),_:1})]),y("div",he,[r(X,{columns:S,"data-source":i.value,bordered:"",pagination:D(w),"row-selection":{selectedRowKeys:p.selectedRowKeys,onChange:V},onChange:W,scroll:{x:1e3}},{customFilterDropdown:u(({setSelectedKeys:c,selectedKeys:v,confirm:n,clearFilters:_,column:R})=>[y("div",ge,[r(N,{ref_key:"searchInput",ref:F,placeholder:`搜索 ${R.title}`,value:v[0],style:{width:"188px","margin-bottom":"8px",display:"block"},onChange:C=>c(C.target.value?[C.target.value]:[]),onPressEnter:C=>O(v,n,R.dataIndex)},null,8,["placeholder","value","onChange","onPressEnter"]),r(s,{type:"primary",size:"small",style:{width:"90px","margin-right":"8px"},onClick:C=>O(v,n,R.dataIndex)},{icon:u(()=>[r(J)]),default:u(()=>[h(" 搜索 ")]),_:2},1032,["onClick"]),r(s,{size:"small",style:{width:"90px"},onClick:C=>A(_)},{default:u(()=>[h(" 重置 ")]),_:2},1032,["onClick"])])]),bodyCell:u(({column:c,text:v,record:n})=>[c.dataIndex==="steamName"?(l(),d("div",{key:0,style:ne({color:n.steamName==""?"var(--ant-primary-color)":"var(--text-color)"})},I(n.steamName||"未找到该steamID下的信息"),5)):["steamId"].includes(c.dataIndex)?(l(),d("div",ve,[a[n.key]?(l(),d("div",ke,[v.length==0?(l(),E(N,{key:0,value:a[n.key][c.dataIndex],"onUpdate:value":_=>a[n.key][c.dataIndex]=_,style:{margin:"-5px 0"}},null,8,["value","onUpdate:value"])):(l(),d(x,{key:1},[h(I(v),1)],64))])):(l(),d(x,{key:1},[h(I(v),1)],64))])):["info"].includes(c.dataIndex)?(l(),d("div",be,[a[n.key]?(l(),E(N,{key:0,value:a[n.key][c.dataIndex],"onUpdate:value":_=>a[n.key][c.dataIndex]=_,style:{margin:"-5px 0"}},null,8,["value","onUpdate:value"])):(l(),d(x,{key:1},[h(I(v),1)],64))])):c.dataIndex==="bansTime"?(l(),d(x,{key:3},[a[n.key]?(l(),E(Q,{key:0,value:a[n.key][c.dataIndex],"onUpdate:value":_=>a[n.key][c.dataIndex]=_,"show-time":"",placeholder:"选择封禁结束时间"},null,8,["value","onUpdate:value"])):(l(),d("div",xe,I(n.bansTime==null||n.bansTime.unix()==0?"永久封禁":n.bansTime.format("YYYY-MM-DD HH:mm:ss")),1))],64)):c.dataIndex==="operation"?(l(),d(x,{key:4},[y("div",Ie,[a[n.key]?(l(),d("span",we,[r(G,{onClick:_=>o(n.key),style:{"margin-right":"10px"}},{default:u(()=>[h("保存")]),_:2},1032,["onClick"]),r(L,{title:"你确定要取消吗",onConfirm:_=>g(n.key),okText:"确定",cancelText:"取消"},{default:u(()=>[Ce]),_:2},1032,["onConfirm"])])):(l(),d("span",Se,[y("a",{onClick:_=>T(n.key)},"编辑",8,Te)]))]),y("div",Be,[r(L,{title:"你确定要删除吗","ok-text":"确定","cancel-text":"取消",onConfirm:_=>m(n.key)},{default:u(()=>[r(s,{type:"link",danger:""},{default:u(()=>[h("删除")]),_:1})]),_:2},1032,["onConfirm"])])],64)):M("",!0)]),_:1},8,["data-source","pagination","row-selection"])])]),_:1})])}}});const Oe=ue(Ne,[["__scopeId","data-v-5ca804b2"]]);export{Oe as default};
